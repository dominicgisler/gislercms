{% extends 'admin/layout.twig' %}

{% block body %}
    <nav class="navbar navbar-dark navbar-expand-md fixed-top bg-dark flex-md-nowrap p-0 shadow justify-content-between">
        <a class="navbar-brand col-7 col-sm-4 col-md-3 col-lg-2 mr-0 p-2" href="{{ admin_url }}">
            <img src="{{ base_url() }}/img/admin/logo-white-small.png" width="32" height="32">
            <span class="align-middle ml-1">GislerCMS</span>
        </a>
        <ul class="navbar-nav pl-3 pr-2">
            <li class="nav-item dropdown d-none d-md-block">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    {{ user.getDisplayName() }}
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="{{ admin_url }}/misc/profile">
                        <i class="fa fa-user fa-fw mr-2"></i>
                        Profil
                    </a>
                    <a class="dropdown-item" href="{{ admin_url }}/misc/change-password">
                        <i class="fa fa-key fa-fw mr-2"></i>
                        Passwort ändern
                    </a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="{{ admin_url }}/logout">
                        <i class="fa fa-sign-out-alt fa-fw mr-2"></i>
                        Abmelden
                    </a>
                </div>
            </li>
            <li class="nav-item d-md-none">
                <button type="button" class="btn btn-outline-secondary" id="toggle-side-navigation">
                    <i class="fa fa-bars"></i>
                </button>
            </li>
        </ul>
    </nav>

    {% set page_trash = 0 %}
    {% for page in pages %}
        {% if page.isTrash() %}
            {% set page_trash = page_trash + 1 %}
        {% endif %}
    {% endfor %}

    {% set widget_trash = 0 %}
    {% for widget in widgets %}
        {% if widget.isTrash() %}
            {% set widget_trash = widget_trash + 1 %}
        {% endif %}
    {% endfor %}

    {%
        set navigation = [
            {
                items: [
                    {
                        route: 'admin-index',
                        label: 'Dashboard',
                        icon: 'fa-home',
                        href: admin_url
                    },
                    {
                        route: 'admin-preview',
                        label: 'Seitenvorschau',
                        icon: 'fa-eye',
                        href: admin_url ~ '/preview'
                    }
                ]
            },
            {
                class: 'd-md-none',
                items: [
                    {
                        route: 'admin-misc-profile',
                        label: 'Profil',
                        icon: 'fa-user',
                        href: admin_url ~ '/misc/profile'
                    },
                    {
                        route: 'admin-misc-change-password',
                        label: 'Passwort ändern',
                        icon: 'fa-key',
                        href: admin_url ~ '/misc/change-password'
                    },
                    {
                        label: 'Abmelden',
                        icon: 'fa-sign-out-alt',
                        href: admin_url ~ '/logout'
                    }
                ]
            },
            {
                title: 'Seiten',
                items: [
                    {
                        route: 'admin-page-all',
                        label: 'Alle Seiten',
                        icon: 'fa-copy',
                        href: admin_url ~ '/page/all',
                        count: pages|length
                    },
                    {
                        label: 'Neue Seite',
                        icon: 'fa-plus',
                        href: admin_url ~ '/page/add'
                    },
                    {
                        route: 'admin-page-defaults',
                        label: 'Standardwerte',
                        icon: 'fa-cog',
                        href: admin_url ~ '/page/defaults'
                    },
                    {
                        route: 'admin-page-trash',
                        label: 'Papierkorb',
                        icon: 'fa-trash-alt',
                        href: admin_url ~ '/page/trash',
                        count: page_trash
                    }
                ]
            },
            {
                title: 'Widgets',
                items: [
                    {
                        route: 'admin-widget-all',
                        label: 'Alle Widgets',
                        icon: 'fa-copy',
                        href: admin_url ~ '/widget/all',
                        count: widgets|length
                    },
                    {
                        label: 'Neues Widget',
                        icon: 'fa-plus',
                        href: admin_url ~ '/widget/add'
                    },
                    {
                        route: 'admin-widget-trash',
                        label: 'Papierkorb',
                        icon: 'fa-trash-alt',
                        href: admin_url ~ '/widget/trash',
                        count: widget_trash
                    }
                ]
            },
            {
                title: 'Module',
                items: [
                    {
                        route: 'admin-module-all',
                        label: 'Alle Module',
                        icon: 'fa-copy',
                        href: admin_url ~ '/module/all',
                        count: modules|length
                    },
                    {
                        label: 'Neues Modul',
                        icon: 'fa-plus',
                        href: admin_url ~ '/module/add'
                    }
                ]
            },
            {
                title: 'Verschiedenes',
                items: [
                    {
                        route: 'admin-misc-config',
                        label: 'Konfiguration',
                        icon: 'fa-cogs',
                        href: admin_url ~ '/misc/config'
                    },
                    {
                        route: 'admin-misc-language-list',
                        label: 'Sprachen',
                        icon: 'fa-language',
                        href: admin_url ~ '/misc/language/list'
                    },
                    {
                        route: 'admin-misc-migration',
                        label: 'Datenbank-Update',
                        icon: 'fa-database',
                        href: admin_url ~ '/misc/migration'
                    },
                    {
                        route: 'admin-misc-sysinfo',
                        label: 'Systeminformation',
                        icon: 'fa-info-circle',
                        href: admin_url ~ '/misc/sysinfo'
                    }
                ]
            }
        ]
    %}
    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-3 col-lg-2 d-none d-md-block sidebar bg-white" id="side-navigation">
                <div class="sidenav">
                    {% for group in navigation %}
                        <div class="list-group list-group-flush {{ group.class }}">
                            {% if group.title|length > 0 %}
                                <div class="list-group-item font-weight-bold">{{ group.title }}</div>
                            {% endif %}
                            {% for item in group.items %}
                                <a href="{{ item.href }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center {% if route == item.route %}active{% endif %}">
                                    <span>
                                        <i class="fa {{ item.icon }} fa-fw mr-2"></i>
                                        {{ item.label }} {% if route == item.route %}<span class="sr-only">(current)</span>{% endif %}
                                    </span>
                                    {% if item.count > 0 %}
                                        <span class="badge badge-dark badge-pill">{{ item.count }}</span>
                                    {% endif %}
                                </a>
                            {% endfor %}
                        </div>
                    {% endfor %}
                </div>
            </nav>

            <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">{% block title %}{% endblock %}</h1>
                </div>
                {% block content %}{% endblock %}
            </main>
        </div>
    </div>
{% endblock %}